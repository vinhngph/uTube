import{r as n,u as V,j as e,M as L,L as O,R as oe,I as P,a as ie,b as le,c as ce,d as de,D as ue,A as he,e as se,f as z,g as me,h as pe,i as fe,k as xe,l as T,B as A,m as ge,n as ve,T as Y,Q as te,F as je,o as ye,p as _,q as $,s as we,t as W,v as b,w as G,x as Q,P as Ie,y as B,z as ke,S as K,C as Se,E as Ne,G as be,H as re,J as Ce,K as De,N as U,O as Ee,U as $e}from"./vendor-D9L_fdEi.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))m(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&m(d)}).observe(document,{childList:!0,subtree:!0});function u(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function m(i){if(i.ep)return;i.ep=!0;const s=u(i);fetch(i.href,s)}})();const Te="/assets/logo-DyBUf4ZX.png",I="https://utube.nguyenphucvinh.io.vn",Pe=({setSidebar:h})=>{const[a,u]=n.useState(!1),[m,i]=n.useState(null),[s,d]=n.useState(""),[v,k]=n.useState([]),y=n.useRef(null),x=V();n.useEffect(()=>{const c=document.cookie.split(";").reduce((f,E)=>{const[R,q]=E.split("=").map(J=>J.trim());return f[R]=decodeURIComponent(q),f},{});c.user&&i(JSON.parse(c.user))},[]),n.useEffect(()=>{s?(async()=>{try{const E=await(await fetch(I+`/api/home/search?key=${s}`)).json();k(E),u(!0)}catch(f){console.error("Error fetching search results:",f),k([]),u(!1)}})():(k([]),u(!1))},[s]);const r=()=>{const c=document.cookie.split(";");for(let f=0;f<c.length;f++){const E=c[f],R=E.indexOf("="),q=R>-1?E.substr(0,R):E;document.cookie=q.trim()+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"}},o=()=>{x("/")},p=()=>{sessionStorage.clear(),r(),x("/login")},S=()=>{x("/upload")},l=()=>{x("/manage-account")},N=()=>{x("/manage-channel")},C=()=>{x("/admin-page")},F=()=>{x("/account-info")},t=c=>{d(c.target.value)},j=c=>{x(`/search?key=${c}`),u(!1)},D=c=>{c.key==="Enter"&&g()},g=()=>{s.trim()!==""&&(x(`/search?key=${encodeURIComponent(s.trim())}`),u(!1))};n.useEffect(()=>{const c=f=>{y.current&&!y.current.contains(f.target)&&u(!1)};return document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[]);const w=e.jsx(L,{children:m?e.jsxs(e.Fragment,{children:[m.role!==1&&e.jsx(L.Item,{onClick:F,children:"Account Information"}),e.jsx(L.Item,{onClick:N,children:"Manage Channel"}),e.jsx(L.Item,{onClick:p,children:"Log Out"}),(m.role===1||m.role===2)&&e.jsx(L.Item,{onClick:l,children:"Manage Account"}),(m.role===1||m.role===2)&&e.jsx(L.Item,{onClick:C,children:"Censor"})]}):e.jsxs(e.Fragment,{children:[e.jsx(L.Item,{children:e.jsx(O,{to:"/login",children:"Sign In"})}),e.jsx(L.Item,{children:e.jsx(O,{to:"/register",children:"Register"})})]})});return e.jsxs("nav",{className:"flex-div",children:[e.jsxs("div",{className:"nav-left",children:[e.jsx(oe,{className:"menu-icon",onClick:()=>h(c=>!c)}),e.jsx(O,{to:"/",onClick:o,children:e.jsx("img",{className:"logo",src:Te,alt:"Logo"})})]}),e.jsx("div",{className:"nav-middle",children:e.jsxs("div",{className:"search-box",children:[e.jsx(P,{placeholder:"Search",value:s,onChange:t,onKeyPress:D,prefix:e.jsx(ie,{onClick:g,style:{cursor:"pointer"}})}),a&&e.jsx("div",{ref:y,className:"search-results",children:v.map(c=>e.jsx("div",{onClick:()=>j(c.name),children:e.jsx("h1",{children:c.name})},c.id))})]})}),e.jsxs("div",{className:"nav-right",children:[e.jsx(le,{className:"nav-icon",onClick:S}),e.jsx(ce,{className:"nav-icon"}),e.jsx(de,{className:"nav-icon"}),e.jsx(ue,{overlay:w,trigger:["click"],placement:"bottomRight",children:e.jsx(he,{icon:e.jsx(se,{}),className:"user-icon"})})]})]})},{Sider:Fe}=fe,M=({sidebar:h})=>{const a=V(),u=z(),m=()=>{switch(u.pathname){case"/":return"1";case"/feed/history":return"2";case"/manage-channel":return"3";default:return"1"}};return e.jsx(Fe,{collapsible:!0,collapsed:!h,className:"sidebar",children:e.jsxs(L,{theme:"light",mode:"inline",selectedKeys:[m()],children:[e.jsx(L.Item,{icon:e.jsx(me,{}),onClick:()=>a("/"),children:"Home"},"1"),e.jsx(L.Item,{icon:e.jsx(pe,{}),onClick:()=>a("/feed/history"),children:"History"},"2"),e.jsx(L.Item,{icon:e.jsx(se,{}),onClick:()=>a("/manage-channel"),children:"You"},"3")]})})},Re=()=>{const[h,a]=n.useState([]),u=V();n.useEffect(()=>{fetch(I+"/api/home/videos").then(s=>s.json()).then(s=>{a(s)}).catch(s=>console.error("Error fetching videos:",s))},[]);const m=s=>{u(`/watch/${s}`)},i=s=>s.length<=50?s:s.slice(0,47)+"...";return e.jsx("div",{className:"feed",children:h.map(s=>e.jsxs("div",{className:"card",onClick:()=>m(s.videoId),children:[e.jsx("img",{src:s.videoThumbnail,alt:s.videoTitle,className:"thumbnail"}),e.jsxs("div",{className:"video-info",children:[e.jsx("h2",{className:"video-title",children:i(s.videoTitle)}),e.jsx("p",{className:"video-channel",children:s.videoChannelName}),e.jsxs("p",{className:"video-views",children:[s.videoViews," views"]}),e.jsx("p",{className:"video-date",children:new Date(s.videoDate).toLocaleDateString()})]})]},s.videoId))})},Ue=({sidebar:h})=>e.jsxs(e.Fragment,{children:[e.jsx(M,{sidebar:h}),e.jsx("div",{className:`container ${h?"":"large-container-home"}`,children:e.jsx(Re,{})})]}),{Title:Le,Paragraph:Ae}=Y,_e=({sidebar:h})=>{const{videoId:a}=xe();n.useState("");const[u,m]=n.useState({title:"",description:"",date:"",owner:""}),[i,s]=n.useState({views:0,likes:0,dislikes:0}),[d,v]=n.useState(""),k=n.useRef(null),y=z(),x=n.useRef(null);n.useEffect(()=>{S(),l();const t=document.querySelector("video");let j=0;const D=()=>{x.current=setInterval(()=>{++j,c()},1e3)},g=()=>{clearInterval(x.current)},w=()=>{clearInterval(x.current)},c=()=>{j>=t.duration/2&&(j=0,N())};return t.addEventListener("play",D),t.addEventListener("pause",g),t.addEventListener("ended",w),()=>{t.removeEventListener("play",D),t.removeEventListener("pause",g),t.removeEventListener("ended",w),clearInterval(x.current)}},[a]),n.useEffect(()=>{const t=document.querySelector("video");return r(t.currentTime),()=>{r(t.currentTime)}},[a,y]);const r=t=>{const j=p();j&&T.post(I+"/api/user/history",null,{params:{user_id:j,video_id:a,track_time:t}}).then(D=>{D.status===200&&D.data.trackTime>0&&(k.current.currentTime=D.data.trackTime,k.current.play())}).catch(D=>{console.error("Error updating user history:",D)})},o=t=>{const D=`; ${document.cookie}`.split(`; ${t}=`);return D.length===2?D.pop().split(";").shift():null},p=()=>{const t=o("user");if(t)try{return JSON.parse(t).userId}catch(j){return console.error("Failed to parse user cookie",j),null}return null},S=()=>{T.get(I+"/api/video/information",{params:{id:a}}).then(t=>{if(t.status===200){let j=t.data.videoDate,D=new Date(j).toLocaleString();T.get(I+"/api/accounts/details",{params:{user_id:t.data.videoOwner}}).then(g=>{m({title:t.data.videoTitle,description:t.data.videoDescription,date:D,owner:g.data.user_fullname})}).catch(g=>{v("Error fetching video owner information."),console.error("Error fetching video owner information:",g)})}else v("Video is not available.")}).catch(t=>{t.response&&t.response.status===404?v("Video not found."):t.response&&t.response.status===500&&v("Server error. Please try again later."),console.error("Error fetching video information:",t)})},l=()=>{T.get(I+"/api/video/interaction",{params:{id:a}}).then(t=>{s({views:t.data.view,likes:t.data.like,dislikes:t.data.dislike})}).catch(t=>{console.error("Error fetching video interactions:",t)})},N=()=>{T.put(I+`/api/video/view?id=${a}`).then(()=>{l()}).catch(t=>{console.error("Error viewing video:",t)})},C=()=>{const t=p();T.put(I+"/api/video/like",null,{params:{user_id:t,video_id:a}}).then(()=>{l()}).catch(j=>{console.error("Error liking video:",j)})},F=()=>{const t=p();T.put(I+"/api/video/dislike",null,{params:{user_id:t,video_id:a}}).then(()=>{l()}).catch(j=>{console.error("Error disliking video:",j)})};return e.jsxs(e.Fragment,{children:[e.jsx(M,{sidebar:h}),e.jsxs("div",{className:`video-container ${h?"":"large-container"}`,children:[d&&e.jsx("p",{className:"error",children:d}),!d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"video-layout",children:[e.jsx("div",{className:"video-column",children:e.jsx("div",{className:"video-wrapper",children:e.jsx("video",{ref:k,controls:!0,className:"video-player",autoPlay:!0,children:e.jsx("source",{src:I+`/api/video?id=${a}`,type:"video/webm"})})})}),e.jsxs("div",{className:"info-column",children:[e.jsx(Le,{level:2,className:"video-title",children:u.title}),e.jsxs("div",{className:"interaction-buttons",children:[e.jsxs(A,{type:"primary",size:"large",onClick:C,icon:e.jsx(ge,{}),children:["Like ",i.likes]}),e.jsxs(A,{type:"danger",size:"large",onClick:F,icon:e.jsx(ve,{}),children:["Dislike ",i.dislikes]})]}),e.jsxs("p",{className:"video-date-1",children:["Posted on: ",u.date]}),e.jsxs("p",{className:"video-owner",children:["Channel: ",u.owner]}),e.jsx(Ae,{className:"video-description",children:u.description})]})]}),e.jsxs("div",{className:"video-views-1",children:["Views: ",i.views]})]})]})]})},Oe=()=>{const a=z().pathname==="/login",u=V(),[m,i]=n.useState(""),[s,d]=n.useState(""),v=(r,o,p)=>{const S=new Date;S.setTime(S.getTime()+p*24*60*60*1e3);const l="expires="+S.toUTCString();document.cookie=`${r}=${o};${l};path=/`},k=r=>{const p=`; ${document.cookie}`.split(`; ${r}=`);return p.length===2?p.pop().split(";").shift():null},y=()=>{const r=k("user");if(r)try{return JSON.parse(r).userId}catch(o){return console.error("Failed to parse user cookie",o),null}return null},x=async r=>{r.preventDefault();try{const o=new URLSearchParams;o.append("username",m),o.append("password",s);const p=await fetch(I+"/api/login",{method:"POST",body:o,credentials:"include"});if(p.ok){const S=await p.json();_.success("Login successful"),console.log(y()),sessionStorage.setItem("username",m);const l=JSON.stringify({userId:S.userId,username:S.username,email:S.email,password:S.password,role:S.role});v("user",l,7),setTimeout(()=>{u("/")},1e3)}else throw new Error("Invalid credentials")}catch(o){_.error("Login failed: "+o.message)}};return e.jsxs(e.Fragment,{children:[e.jsx(te,{}),a&&e.jsx("div",{className:`container ${a?"login-background":""}`,children:e.jsx("div",{className:"wrapper",children:e.jsxs("form",{onSubmit:x,children:[e.jsx("h1",{children:"Login"}),e.jsxs("div",{className:"input-box",children:[e.jsx("input",{type:"text",placeholder:"Username",value:m,onChange:r=>i(r.target.value),required:!0}),e.jsx(je,{className:"icon"})]}),e.jsxs("div",{className:"input-box",children:[e.jsx("input",{type:"password",placeholder:"Password",value:s,onChange:r=>d(r.target.value),required:!0}),e.jsx(ye,{className:"icon"})]}),e.jsx("div",{className:"remember-forgot",children:e.jsx(O,{to:"/forgot-password",children:"Forgot password?"})}),e.jsx("button",{type:"submit",children:"Login"}),e.jsx("div",{className:"register-link",children:e.jsxs("p",{children:["Don't have an account? ",e.jsx(O,{to:"/register",children:"Register"})]})})]})})})]})},Me=()=>{const h=z(),a=V(),u=h.pathname==="/register",[m,i]=n.useState(1),[s,d]=n.useState({email:"",username:"",password:"",fullName:"",dob:""}),[v,k]=n.useState(""),[y,x]=n.useState(""),[r,o]=n.useState(""),p=async t=>{const{value:j}=t.target;d({...s,email:j}),j?await l("email",j):x("")},S=async t=>{const{value:j}=t.target;d({...s,username:j}),j?await l("username",j):o("")},l=async(t,j)=>{const D=`${I}/api/accounts/isUser/${t}?${t}=${j}`;try{const g=await fetch(D,{method:"GET"});g.status===409?t==="email"?x("exists"):t==="username"&&o("exists"):g.status===200&&(t==="email"?x("available"):t==="username"&&o("available"))}catch(g){console.error("Error checking availability:",g)}},N=()=>{i(m+1)},C=()=>{i(m-1)},F=async()=>{if(m===1)y==="available"&&r==="available"?N():k("Please fix the errors before proceeding");else try{const t=new FormData;t.append("email",s.email),t.append("username",s.username),t.append("password",s.password),t.append("fullName",s.fullName),t.append("dob",W(s.dob).format("YYYY-MM-DD"));const j=await fetch(`${I}/api/register`,{method:"POST",body:t,credentials:"include"});if(!j.ok)throw new Error("Registration failed");const D=await j.json();console.log("Registration Successful",D),b.success("Registration successful"),a("/login")}catch(t){console.error("Registration Error:",t.message),k("Registration failed. Please try again.")}};return e.jsx(e.Fragment,{children:u&&e.jsx("div",{className:`container youtube-theme ${u?"login-background":""}`,children:e.jsx("div",{className:"wrapper",children:e.jsxs($,{onFinish:F,children:[m===1&&e.jsxs("div",{id:"step1",children:[e.jsx("h2",{children:"Account Information"}),e.jsx("label",{htmlFor:"",className:"label-register",children:"Email:"}),e.jsx($.Item,{validateStatus:y==="exists"?"error":y==="available"?"success":"",help:y==="exists"?"Email already taken":"",children:e.jsx(P,{type:"email",id:"email",name:"email",value:s.email,onChange:p,required:!0,className:`${!s.email||y==="exists"?"input-black":"input-white"} ${y==="exists"?"ant-input-error":y==="available"?"ant-input-success":""}`,suffix:y==="exists"?e.jsx("span",{className:"input-suffix",children:"Email already taken"}):null})}),e.jsx("label",{htmlFor:"",className:"label-register",children:"Username:"}),e.jsx($.Item,{validateStatus:r==="exists"?"error":r==="available"?"success":"",help:r==="exists"?"Username already taken":"",children:e.jsx(P,{type:"text",id:"username",name:"username",value:s.username,onChange:S,required:!0,className:`${!s.username||r==="exists"?"input-black":"input-white"} ${r==="exists"?"ant-input-error":r==="available"?"ant-input-success":""}`,suffix:r==="exists"?e.jsx("span",{className:"input-suffix",children:"Username already taken"}):null})}),e.jsx("label",{htmlFor:"",className:"label-register",children:"Password:"}),e.jsx($.Item,{children:e.jsx(P.Password,{id:"password",name:"password",value:s.password,onChange:t=>d({...s,password:t.target.value}),required:!0})}),e.jsxs($.Item,{children:[e.jsx(A,{type:"primary",htmlType:"submit",children:"Next"}),v&&e.jsx("p",{className:"error",children:v})]})]}),m===2&&e.jsxs("div",{id:"step2",children:[e.jsx("h2",{children:"Personal Information"}),e.jsx("label",{htmlFor:"",className:"label-register",children:"Full Name:"}),e.jsx($.Item,{children:e.jsx(P,{type:"text",id:"fullname",name:"fullName",value:s.fullName,onChange:t=>d({...s,fullName:t.target.value}),required:!0})}),e.jsx("label",{htmlFor:"",className:"label-register",children:"Date of Birth:"}),e.jsx($.Item,{children:e.jsx(we,{id:"dob",name:"dob",value:s.dob?W(s.dob,"YYYY-MM-DD"):null,onChange:(t,j)=>d({...s,dob:j}),required:!0})}),e.jsx($.Item,{className:"custom-button-item",children:e.jsx(A,{type:"default",onClick:C,className:"custom-back-button",children:"Back"})}),e.jsx($.Item,{className:"custom-button-item",children:e.jsx(A,{type:"primary",htmlType:"submit",className:"custom-complete-button",children:"Complete"})})]})]})})})})},{Title:Ve}=Y,{TextArea:ze}=P,qe=({sidebar:h})=>{const[a,u]=n.useState(""),[m,i]=n.useState(""),[s,d]=n.useState(null),[v,k]=n.useState(null),[y,x]=n.useState(null),[r,o]=n.useState(0),[p,S]=n.useState(""),[l,N]=n.useState("");n.useEffect(()=>{console.log("cookies",document.cookie);const g=document.cookie.split(";").reduce((w,c)=>{const[f,E]=c.split("=").map(R=>R.trim());return w[f]=decodeURIComponent(E),w},{});if(g.user){const w=JSON.parse(g.user);x(w.userId)}},[]);const C=g=>{u(g.currentTarget.value)},F=g=>{i(g.currentTarget.value)},t=g=>{const w=g[0];w&&w.type.startsWith("video/")?(d(w),S(URL.createObjectURL(w))):b.error("Please upload a valid video file")},j=g=>{const w=g[0];w&&w.type.startsWith("image/")?(k(w),N(URL.createObjectURL(w))):b.error("Please upload a valid image file")},D=()=>{if(!a||!m||!s||!v||!y)return b.error("Please fill all the fields and upload the required files");const g=new FormData;g.append("videoFile",s),g.append("thumbnailFile",v),g.append("title",a),g.append("description",m),g.append("userId",y);const w=new XMLHttpRequest;w.open("POST",I+"/api/video/upload",!0),w.upload.onprogress=c=>{if(c.lengthComputable){const f=Math.round(c.loaded/c.total*100);o(f)}},w.onload=()=>{console.log(w.responseText),w.status===200?(JSON.parse(w.responseText),b.success("Video uploaded successfully"),o(100)):(b.error("Failed to upload video"),o(0))},w.onerror=()=>{b.error("Failed to upload video"),o(0)},w.send(g)};return e.jsxs(e.Fragment,{children:[e.jsx(M,{sidebar:h}),e.jsxs("div",{className:`upload-video-container ${h?"":"large-container"}`,children:[e.jsx("div",{className:"upload-video-header",children:e.jsx(Ve,{level:2,children:"Upload Video "})}),e.jsxs($,{children:[e.jsxs("div",{className:"dropzone-container",children:[e.jsxs("div",{className:"dropzone-section",children:[e.jsx("label",{children:"Video File (Allow video type)"}),e.jsx(G,{onDrop:t,multiple:!1,children:({getRootProps:g,getInputProps:w})=>e.jsxs("div",{className:"dropzone",...g(),children:[e.jsx("input",{...w(),accept:"video/*"}),s?e.jsx("video",{width:"100%",height:"240px",controls:!0,children:e.jsx("source",{src:p,type:"video/mp4"})}):e.jsx(Q,{style:{fontSize:"3rem"}})]})})]}),e.jsxs("div",{className:"dropzone-section",children:[e.jsx("label",{children:"Thumbnail File"}),e.jsx(G,{onDrop:j,multiple:!1,maxSize:8e8,children:({getRootProps:g,getInputProps:w})=>e.jsxs("div",{className:"dropzone",...g(),children:[e.jsx("input",{...w()}),v?e.jsx("img",{src:l,alt:"Thumbnail",width:"100%",height:"240px"}):e.jsx(Q,{style:{fontSize:"3rem"}})]})})]})]}),r>0&&e.jsx(Ie,{percent:r}),e.jsx("label",{children:"Title"}),e.jsx(P,{onChange:C,value:a}),e.jsx("label",{children:"Description"}),e.jsx(ze,{onChange:F,value:m}),e.jsx(A,{type:"primary",size:"large",onClick:D,className:"submit-button",children:"Submit"})]})]})]})},Je=({sidebar:h})=>{const[a,u]=n.useState([]),[m,i]=n.useState([]),[s,d]=n.useState(!0),[v,k]=n.useState(null),[y,x]=n.useState(""),[r,o]=n.useState(null),[p,S]=n.useState(!1),l=c=>{const E=`; ${document.cookie}`.split(`; ${c}=`);return E.length===2?E.pop().split(";").shift():null},N=()=>{const c=l("user");if(c)try{return JSON.parse(c)}catch(f){return console.error("Failed to parse user cookie",f),null}return null};n.useEffect(()=>{const c=N();c&&o(c.role),(async()=>{try{const E=await T.get(I+"/api/accounts/users"),R=await T.get(I+"/api/accounts/admins");u(E.data),i(R.data)}catch(E){console.error("Error fetching accounts:",E),b.error("An error occurred while fetching accounts.")}finally{d(!1)}})()},[]);const C=async(c,f)=>{try{await T.put(I+"/api/admin/accounts",null,{params:{current_user_id:N().userId,modify_user_id:c,modify_role:f}}),b.success("Role updated successfully.");const E=a.map(R=>R.userId===c?{...R,role:f}:R);u(E)}catch(E){if(E.response)switch(E.response.status){case 403:b.error("You do not have permission to update this role.");break;case 404:b.error("Cannot find role for modified account.");break;case 304:b.error("Error when updating role.");break;default:b.error("An error occurred while updating the role.")}else b.error("An error occurred while updating the role.")}},F=async c=>{try{await T.delete(I+"/api/admin/accounts",{params:{current_user_id:N().userId,delete_user_id:c}}),b.success("Account deleted successfully.");const f=a.filter(E=>E.userId!==c);u(f)}catch(f){if(f.response)switch(f.response.status){case 403:b.error("You do not have permission to delete this account.");break;case 404:b.error("Cannot find delete role account.");break;case 304:b.error("Error when deleting account.");break;default:b.error("An error occurred while deleting the account.")}else b.error("An error occurred while deleting the account.")}},t=async c=>{try{const f=await T.get(I+"/api/accounts/details",{params:{user_id:c}});k(f.data),S(!0)}catch(f){f.response?f.response.status===404?x("User ID not found or something went wrong."):f.response.status===500?x("Internal Server Error. Please try again later."):x("An error occurred while fetching account details."):x("An error occurred while fetching account details."),k(null)}},j=()=>{S(!1),k(null),x("")},D=c=>c.filter(f=>r===1?f.role===1||f.role===2||f.role===3:r===2?f.role===2||f.role===3:!1),g=[{title:"User ID",dataIndex:"userId",key:"userId"},{title:"Username",dataIndex:"username",key:"username"},{title:"Actions",key:"actions",render:(c,f)=>e.jsxs(e.Fragment,{children:[e.jsx(A,{type:"primary",onClick:()=>C(f.userId,"2"),style:{marginRight:8},children:"Update"}),e.jsx(A,{type:"danger",onClick:()=>F(f.userId),children:"Delete"})]})}],w=[{title:"User ID",dataIndex:"userId",key:"userId"},{title:"Username",dataIndex:"username",key:"username"}];return r===1&&w.push({title:"Actions",key:"actions",render:(c,f)=>e.jsx(A,{type:"danger",onClick:()=>F(f.userId),children:"Delete"})}),e.jsxs(e.Fragment,{children:[e.jsx(M,{sidebar:h}),e.jsx("div",{className:`manage-account ${h?"":"large-container"}`,children:s?e.jsx("p",{children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Users"}),e.jsx(B,{columns:g,dataSource:D(a),rowKey:"userId",pagination:{pageSize:5},onRow:c=>({onClick:()=>t(c.userId)})}),e.jsx("h2",{children:"Admin"}),e.jsx(B,{columns:w,dataSource:D(m),rowKey:"userId",pagination:{pageSize:5},onRow:c=>({onClick:()=>t(c.userId)})}),e.jsx(ke,{visible:p,title:"Account Details",onCancel:j,footer:null,children:y?e.jsx("p",{className:"error",children:y}):v&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Username: ",v.user_fullname]}),e.jsxs("p",{children:["Birthday: ",v.user_dob]})]})})]})})]})},Ye=({sidebar:h})=>{const[a,u]=n.useState(null),[m,i]=n.useState([]),[s,d]=n.useState(null),[v,k]=n.useState(!0),y=r=>{const p=`; ${document.cookie}`.split(`; ${r}=`);return p.length===2?p.pop().split(";").shift():null},x=()=>{const r=y("user");if(r)try{return JSON.parse(r).userId}catch(o){return console.error("Failed to parse user cookie",o),null}return null};return n.useEffect(()=>{const r=x();r?u(r):d("User not logged in or invalid user data.")},[]),n.useEffect(()=>{k(!0),T.get(I+"/api/user/video/management",{params:{user_id:a}}).then(r=>{i(r.data),d(""),k(!1)}).catch(r=>{k(!1),r.response?r.response.status===400?d("Missing parameter: user_id."):r.response.status===404?d("User ID not found."):d("Error fetching videos. Please try again later."):d("Error fetching videos. Please try again later."),console.error("Error fetching videos:",r)})},[a]),v?e.jsx(K,{size:"large"}):s?e.jsxs("div",{children:["Error: ",s]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{sidebar:h}),e.jsx("div",{className:`manage-channel-container ${h?"":"large-container"}`,children:e.jsxs("div",{className:"manage-channel",children:[e.jsx("h1",{children:"Manage Channel"}),s?e.jsx("p",{className:"error-message",children:s}):m.length>0?e.jsx("div",{className:"video-list",children:m.map(r=>e.jsxs("div",{className:"video-item",children:[e.jsx(O,{to:`/watch/${r.videoId}`,children:e.jsx("img",{src:r.videoThumbnail,alt:r.videoTitle,className:"video-thumbnail"})}),e.jsxs("div",{className:"video-details",children:[e.jsx("h2",{className:"video-title",children:r.videoTitle}),e.jsx("p",{className:"video-description",children:r.videoDescription}),e.jsx("p",{className:"video-date",children:new Date(r.videoDate).toLocaleDateString()})]})]},r.videoId))}):e.jsx("p",{children:"No videos found."})]})})]})},{Title:Be,Paragraph:Ke}=Y,He=({sidebar:h})=>{const[a,u]=n.useState([]),[m,i]=n.useState(""),[s,d]=n.useState(!0),v=z(),y=new URLSearchParams(v.search).get("key");n.useEffect(()=>{r()},[y]);const x=o=>o.length<=20?o:o.slice(0,17)+"...",r=async()=>{d(!0);try{if(y){const o=encodeURIComponent(y),S=(await T.get(I+`/api/home/search/results?key=${o}`)).data;S.length>0?(u(S),i("")):(i("No search results found."),u([]))}else i("No search query specified."),u([])}catch{i("An error occurred while fetching the search results."),u([])}finally{d(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(M,{sidebar:h}),e.jsxs("div",{className:`search-page ${h?"":"large-container"}`,children:[e.jsxs(Be,{level:2,children:['Search Results for "',y||"",'"']}),s?e.jsx("div",{className:"loader"}):m?e.jsx(Ke,{children:m}):e.jsx("div",{className:"video-list",children:a.length>0?a.map(o=>e.jsxs(Se,{className:"video-card",hoverable:!0,children:[e.jsx(O,{to:`/watch/${o.videoId}`,className:"thumbnail-container",children:e.jsx("img",{alt:o.videoTitle,src:o.videoThumbnail,className:"card-img-top"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(O,{to:`/watch/${o.videoId}`,children:e.jsx("h5",{className:"card-title",children:x(o.videoTitle)})}),e.jsx("h3",{className:"card-text",children:o.videoChannelName}),e.jsx("div",{className:"card-details",children:e.jsxs("span",{className:"views",children:[o.videoViews," views"]})})]})]},o.videoId)):e.jsx(Ne,{description:"No search results found."})})]})]})},We=({sidebar:h})=>{const[a,u]=n.useState([]),[m,i]=n.useState(!0),[s,d]=n.useState(null);n.useEffect(()=>{y()},[]);const v=o=>{const S=`; ${document.cookie}`.split(`; ${o}=`);return S.length===2?S.pop().split(";").shift():null},k=()=>{const o=v("user");if(o)try{return JSON.parse(o).userId}catch(p){return console.error("Failed to parse user cookie",p),null}return null},y=async()=>{const o=k();if(!o){d("User ID not found in cookie"),i(!1);return}try{const p=await T.get(I+`/api/user/history?user_id=${o}`);u(p.data||[]),i(!1)}catch(p){p.response?p.response.status===400?d("Missing parameter"):p.response.status===404?d("User ID not found"):d("Failed to fetch data"):d("Network error"),i(!1)}},x=async o=>{try{const p=k();if(!p){d("User ID not found in cookie");return}await T.delete(I+`/api/user/history?video_id=${o}&user_id=${p}`),y()}catch(p){console.error("Failed to delete video:",p)}},r=[{title:"Thumbnail",dataIndex:"videoThumbnail",key:"thumbnail",render:(o,p)=>e.jsx(O,{to:`/watch/${p.videoId}`,className:"thumbnail-container",children:e.jsx("img",{src:o,alt:p.videoTitle,className:"card-img-top"})})},{title:"Title",dataIndex:"videoTitle",key:"title",render:o=>e.jsx("span",{children:o})},{title:"Description",dataIndex:"videoDescription",key:"description",render:o=>e.jsx("span",{children:o})},{title:"Watched",dataIndex:"trackTime",key:"trackTime",render:o=>e.jsxs("span",{children:[o," seconds"]})},{title:"Action",key:"action",render:(o,p)=>e.jsx(be,{size:"middle",children:e.jsx("button",{onClick:()=>x(p.videoId),className:"delete-button",children:"Remove"})})}];return m?e.jsx(K,{size:"large"}):s?e.jsxs("div",{children:["Error: ",s]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{sidebar:h}),e.jsxs("div",{className:`history-container ${h?"":"large-container"}`,children:[e.jsx("h1",{className:"history-title",children:"Watch History"}),e.jsx(B,{dataSource:a,columns:r,rowKey:"videoId",pagination:{pageSize:5}})]})]})};re.setAppElement("#root");const Ge=({sidebar:h})=>{const[a,u]=n.useState([]),[m,i]=n.useState(!0),[s,d]=n.useState(""),[v,k]=n.useState(null),y=l=>{const C=`; ${document.cookie}`.split(`; ${l}=`);return C.length===2?C.pop().split(";").shift():null},x=()=>{const l=y("user");if(l)try{return JSON.parse(l).userId}catch(N){return console.error("Failed to parse user cookie",N),null}return null};n.useEffect(()=>{const l=x();T.get(I+`/api/admin/review?user_id=${l}`).then(N=>{u(N.data||[]),i(!1)}).catch(N=>{console.error("Error fetching videos:",N),d("Error fetching videos"),i(!1)})},[]);const r=l=>{const N=x();T.put(I+`/api/admin/review?user_id=${N}&video_id=${l}`).then(C=>{C.status===200?(u(F=>F.filter(t=>t.videoId!==l)),_.success("Video accepted successfully")):C.status===401?(d("Invalid role to modify"),_.error("Invalid role to modify")):C.status===404&&(d("Cannot find this video"),_.error("Cannot find this video"))}).catch(C=>{console.error("Error accepting video:",C),d("Error accepting video"),_.error("Error accepting video")})},o=l=>{const N=x();T.delete(I+`/api/admin/review?user_id=${N}&video_id=${l}`).then(C=>{C.status===200?(u(F=>F.filter(t=>t.videoId!==l)),_.success("Video deleted successfully")):C.status===401?(d("Invalid role to delete"),_.error("Invalid role to delete")):C.status===404&&(d("Cannot find this video"),_.error("Cannot find this video"))}).catch(C=>{console.error("Error deleting video:",C),d("Error deleting video"),_.error("Error deleting video")})},p=l=>{k(l)},S=()=>{k(null)};return m?e.jsx(K,{size:"large"}):s?e.jsxs("div",{children:["Error: ",s]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{sidebar:h}),e.jsxs("div",{className:`admin-page ${h?"":"large-container"}`,children:[e.jsx(te,{}),e.jsx("h1",{children:"Admin Page"}),s&&e.jsx("p",{style:{color:"red"},children:s}),e.jsx("ul",{className:"video-list",children:a.map(l=>e.jsxs("li",{className:"video-item",children:[e.jsx("div",{onClick:()=>p(l),children:e.jsx("img",{src:I+`/api/video/thumbnail?id=${l.videoId}`,alt:l.videoTitle})}),e.jsxs("div",{className:"video-details",children:[e.jsx("h2",{className:"video-title",children:l.videoTitle}),e.jsx("p",{className:"video-description",children:l.videoDescription}),e.jsx("p",{className:"video-meta",children:new Date(l.videoDate).toLocaleString()}),e.jsxs("p",{className:"video-owner",children:["Owner: ",l.videoChannelName]}),e.jsxs("p",{className:"video-meta",children:["Status: ",l.videoStatus?"Accepted":"Pending"]}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{className:"button-accept",onClick:()=>r(l.videoId),children:"Accept"}),e.jsx("button",{className:"button-delete",onClick:()=>o(l.videoId),children:"Delete"})]})]})]},l.videoId))}),v&&e.jsxs(re,{isOpen:!!v,onRequestClose:S,className:"react-modal-content",overlayClassName:"react-modal-overlay",children:[e.jsx("h2",{children:v.videoTitle}),e.jsx("p",{children:v.videoDescription}),e.jsx("p",{children:new Date(v.videoDate).toLocaleString()}),e.jsxs("p",{children:["Owner: ",v.videoOwner]}),e.jsxs("p",{children:["Status: ",v.videoStatus?"Accepted":"Pending"]}),e.jsxs("video",{width:"100%",controls:!0,children:[e.jsx("source",{src:I+`/api/video?id=${v.videoId}`,type:"video/webm"}),"Your browser does not support the video tag."]}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{className:"button-accept",onClick:()=>{r(v.videoId),S()},children:"Accept"}),e.jsx("button",{className:"button-delete",onClick:()=>{o(v.videoId),S()},children:"Delete"})]})]})]})]})},{Title:X}=Y,Qe=h=>{const u=`; ${document.cookie}`.split(`; ${h}=`);return u.length===2?u.pop().split(";").shift():null},Z=()=>{const h=Qe("user");if(h)try{return JSON.parse(h).userId}catch(a){return console.error("Failed to parse user cookie",a),null}return null},Xe=({sidebar:h})=>{const[a,u]=n.useState(null),[m,i]=n.useState(null),[s,d]=n.useState(!1),[v,k]=n.useState([]);n.useEffect(()=>{(async()=>{const N=Z();if(!N){i("User ID not found in cookies");return}try{let t=(await(await fetch(I+"/api/accounts/users")).json()).find(H=>H.userId===N);if(t||(t=(await(await fetch(I+"/api/accounts/admins")).json()).find(ne=>ne.userId===N)),!t){i("User not found");return}const j=await fetch(I+`/api/accounts/details?user_id=${N}`);if(j.status===404){i("User ID is wrong or something went wrong");return}const D=await j.json(),g=new Date(D.user_dob),w=g.getFullYear(),c=String(g.getMonth()+1).padStart(2,"0"),f=String(g.getDate()).padStart(2,"0"),E=`${w}-${c}-${f}`,R=D.user_id,q=D.user_fullname;u({user_dob:E,user_id:R,user_fullname:q,email:t.email,username:t.username});const J=await fetch(I+`/api/accounts/sessions?user_id=${N}`);if(J.status===400){i("Missing parameter");return}if(J.status===500){i("Server error");return}const ae=await J.json();k(ae)}catch{i("Failed to fetch account details")}})()},[]);const y=()=>{d(!s)},x=l=>{u({...a,user_fullname:l.target.value})},r=l=>{u({...a,user_dob:l.target.value})},o=async()=>{try{const l=Z();if(!l){i("User ID not found in cookies");return}const{user_fullname:N,user_dob:C}=a;await T.put(I+`/api/accounts/details?user_id=${l}&full_name=${N}&dob=${C}`),d(!1),i(null),b.success("Account details updated successfully")}catch{i("Failed to save account details")}},p=l=>new Date(l).toLocaleString();if(m)return e.jsx(Ce,{message:"Error",description:m,type:"error",showIcon:!0});if(!a)return e.jsx(K,{size:"large"});const S=[{title:"Session ID",dataIndex:"sessionId",key:"sessionId"},{title:"User ID",dataIndex:"sessionUser",key:"sessionUser"},{title:"Session Time",dataIndex:"sessionTime",key:"sessionTime",render:l=>p(l)},{title:"Session Device",dataIndex:"sessionDevice",key:"sessionDevice"}];return e.jsxs(e.Fragment,{children:[e.jsx(M,{sidebar:h}),e.jsxs("div",{className:`account-info-container ${h?"":"large-container"}`,children:[e.jsx(X,{level:2,className:"account-info-title",children:"Account Details"}),e.jsxs($,{layout:"vertical",className:"account-info-form",children:[e.jsx($.Item,{label:"User ID",children:e.jsx(P,{value:a.user_id,readOnly:!0})}),e.jsx($.Item,{label:"Email",children:e.jsx(P,{value:a.email,readOnly:!0})}),e.jsx($.Item,{label:"Username",children:e.jsx(P,{value:a.username,readOnly:!0})}),e.jsx($.Item,{label:"Full Name",children:s?e.jsx(P,{value:a.user_fullname,onChange:x}):e.jsx(P,{value:a.user_fullname,readOnly:!0})}),e.jsx($.Item,{label:"Date of Birth",children:s?e.jsx(P,{type:"date",value:a.user_dob,onChange:r}):e.jsx(P,{type:"date",value:a.user_dob,readOnly:!0})}),e.jsx($.Item,{children:e.jsx(A,{type:"primary",onClick:s?o:y,children:s?"Save":"Edit"})})]}),e.jsx(X,{level:3,className:"session-info-title",children:"Session Information"}),e.jsx(B,{dataSource:v,columns:S,rowKey:"sessionId"})]})]})},{Title:ee}=Y,Ze=()=>{const[h,a]=n.useState(""),[u,m]=n.useState(1),[i,s]=n.useState(""),[d,v]=n.useState(""),k=V(),y=async()=>{try{(await T.post(I+`/api/accounts/forgot-password?email=${h}`)).status===200&&(m(2),b.success("OTP sent to your email."))}catch(r){r.response?r.response.status===404?b.error("Email not found"):r.response.status===500?b.error("Server error. Please try again later."):b.error("Failed to send OTP. Please check your email and try again."):b.error("Failed to send OTP. Please check your email and try again.")}},x=async()=>{try{(await T.put(I+`/api/accounts/forgot-password?email=${h}&otp=${i}&new_password=${d}`)).status===200&&(b.success("Password reset successful. Redirecting to login..."),k("/login"))}catch(r){r.response&&r.response.status===400?b.error("Invalid OTP. Please try again."):b.error("Invalid OTP or email not found. Please try again.")}};return e.jsx("div",{className:"forgot-password-container",children:u===1?e.jsxs("div",{className:"forgot-password-form",children:[e.jsx(ee,{level:2,children:"Forgot Password"}),e.jsxs($,{onFinish:y,children:[e.jsx($.Item,{label:"Email",name:"email",rules:[{required:!0,message:"Please input your email!"}],children:e.jsx(P,{type:"email",value:h,onChange:r=>a(r.target.value)})}),e.jsx($.Item,{children:e.jsx(A,{type:"primary",htmlType:"submit",block:!0,children:"Send OTP"})})]})]}):e.jsxs("div",{className:"forgot-password-form",children:[e.jsx(ee,{level:2,children:"Enter OTP"}),e.jsxs($,{onFinish:x,children:[e.jsx($.Item,{label:"OTP",name:"otp",rules:[{required:!0,message:"Please input the OTP!"}],children:e.jsx(P,{value:i,onChange:r=>s(r.target.value)})}),e.jsx($.Item,{label:"New Password",name:"newPassword",rules:[{required:!0,message:"Please input your new password!"}],children:e.jsx(P.Password,{value:d,onChange:r=>v(r.target.value)})}),e.jsx($.Item,{children:e.jsx(A,{type:"primary",htmlType:"submit",block:!0,children:"Submit OTP"})})]})]})})},es=()=>{const h=z(),[a,u]=n.useState(!0),m=h.pathname==="/login",i=h.pathname==="/register",s=h.pathname==="/forgot-password";return e.jsxs("div",{children:[!m&&!i&&!s&&e.jsx(Pe,{setSidebar:u}),e.jsxs(De,{children:[e.jsx(U,{path:"/login",element:e.jsx(Oe,{})}),e.jsx(U,{path:"/register",element:e.jsx(Me,{})}),e.jsx(U,{path:"/forgot-password",element:e.jsx(Ze,{})}),e.jsx(U,{path:"/",element:e.jsx(Ue,{sidebar:a})}),e.jsx(U,{path:"/upload",element:e.jsx(qe,{sidebar:a})}),e.jsx(U,{path:"/account-info",element:e.jsx(Xe,{sidebar:a})}),e.jsx(U,{path:"/admin-page",element:e.jsx(Ge,{sidebar:a})}),e.jsx(U,{path:"/manage-account",element:e.jsx(Je,{sidebar:a})}),e.jsx(U,{path:"/manage-channel",element:e.jsx(Ye,{sidebar:a})}),e.jsx(U,{path:"/watch/:videoId",element:e.jsx(_e,{sidebar:a})}),e.jsx(U,{path:"/search",element:e.jsx(He,{sidebar:a})}),e.jsx(U,{path:"/feed/history",element:e.jsx(We,{sidebar:a})})]})]})};Ee.createRoot(document.getElementById("root")).render(e.jsx($e,{children:e.jsx(es,{})}));
