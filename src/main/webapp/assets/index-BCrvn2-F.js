import{r as n,u as B,j as e,M as O,L as z,R as ie,I as F,a as ce,b as le,c as de,d as ue,D as he,A as me,e as X,f as K,g as pe,h as fe,i as xe,k as ge,l as E,B as A,m as ve,n as je,o as ye,p as we,T as W,Q as ne,F as Ie,q as ke,s as V,t as C,v as Ne,w as ee,x as b,y as se,z as te,P as Se,C as Z,E as be,S as G,G as Ce,H as De,J as Ee,K as oe,N as $e,O as Pe,U as L,V as Te,W as Re}from"./vendor-B2ZZamzU.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))m(c);new MutationObserver(c=>{for(const s of c)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&m(u)}).observe(document,{childList:!0,subtree:!0});function p(c){const s={};return c.integrity&&(s.integrity=c.integrity),c.referrerPolicy&&(s.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?s.credentials="include":c.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function m(c){if(c.ep)return;c.ep=!0;const s=p(c);fetch(c.href,s)}})();const Fe="/assets/logo-DyBUf4ZX.png",w="https://utube.nguyenphucvinh.io.vn",Ue=({setSidebar:d})=>{const[o,p]=n.useState(!1),[m,c]=n.useState(null),[s,u]=n.useState(""),[g,k]=n.useState([]),v=n.useRef(null),j=B();n.useEffect(()=>{const i=document.cookie.split(";").reduce((a,S)=>{const[R,$]=S.split("=").map(U=>U.trim());return a[R]=decodeURIComponent($),a},{});i.user&&c(JSON.parse(i.user))},[]),n.useEffect(()=>{s?(async()=>{try{const S=await(await fetch(w+`/api/home/search?key=${s}`)).json();k(S),p(!0)}catch(a){console.error("Error fetching search results:",a),k([]),p(!1)}})():(k([]),p(!1))},[s]);const t=()=>{const i=document.cookie.split(";");for(let a=0;a<i.length;a++){const S=i[a],R=S.indexOf("="),$=R>-1?S.substr(0,R):S;document.cookie=$.trim()+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"}},r=()=>{j("/")},f=()=>{sessionStorage.clear(),t(),j("/login")},I=()=>{j("/upload")},x=()=>{j("/manage-account")},D=()=>{j("/manage-channel")},N=()=>{j("/admin-page")},l=()=>{j("/account-info")},h=i=>{u(i.target.value)},y=i=>{j(`/search?key=${i}`),p(!1)},P=i=>{i.key==="Enter"&&T()},T=()=>{s.trim()!==""&&(j(`/search?key=${encodeURIComponent(s.trim())}`),p(!1))};n.useEffect(()=>{const i=a=>{v.current&&!v.current.contains(a.target)&&p(!1)};return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[]);const M=e.jsx(O,{children:m?e.jsxs(e.Fragment,{children:[m.role!==1&&e.jsx(O.Item,{onClick:l,children:"Account Information"}),e.jsx(O.Item,{onClick:D,children:"Manage Channel"}),e.jsx(O.Item,{onClick:f,children:"Log Out"}),(m.role===1||m.role===2)&&e.jsx(O.Item,{onClick:x,children:"Manage Account"}),(m.role===1||m.role===2)&&e.jsx(O.Item,{onClick:N,children:"Censor"})]}):e.jsxs(e.Fragment,{children:[e.jsx(O.Item,{children:e.jsx(z,{to:"/login",children:"Sign In"})}),e.jsx(O.Item,{children:e.jsx(z,{to:"/register",children:"Register"})})]})});return e.jsxs("nav",{className:"flex-div",children:[e.jsxs("div",{className:"nav-left",children:[e.jsx(ie,{className:"menu-icon",onClick:()=>d(i=>!i)}),e.jsx(z,{to:"/",onClick:r,children:e.jsx("img",{className:"logo",src:Fe,alt:"Logo"})})]}),e.jsx("div",{className:"nav-middle",children:e.jsxs("div",{className:"search-box",children:[e.jsx(F,{placeholder:"Search",value:s,onChange:h,onKeyPress:P,prefix:e.jsx(ce,{onClick:T,style:{cursor:"pointer"}})}),o&&e.jsx("div",{ref:v,className:"search-results",children:g.map(i=>e.jsx("div",{onClick:()=>y(i.name),children:e.jsx("h1",{children:i.name})},i.id))})]})}),e.jsxs("div",{className:"nav-right",children:[e.jsx(le,{className:"nav-icon",onClick:I}),e.jsx(de,{className:"nav-icon"}),e.jsx(ue,{className:"nav-icon"}),e.jsx(he,{overlay:M,trigger:["click"],placement:"bottomRight",children:e.jsx(me,{icon:e.jsx(X,{}),className:"user-icon"})})]})]})},{Sider:Le}=xe,q=({sidebar:d})=>{const o=B(),p=K(),m=()=>{switch(p.pathname){case"/":return"1";case"/feed/history":return"2";case"/manage-channel":return"3";default:return"1"}};return e.jsx(Le,{collapsible:!0,collapsed:!d,className:"sidebar",children:e.jsxs(O,{theme:"light",mode:"inline",selectedKeys:[m()],children:[e.jsx(O.Item,{icon:e.jsx(pe,{}),onClick:()=>o("/"),children:"Home"},"1"),e.jsx(O.Item,{icon:e.jsx(fe,{}),onClick:()=>o("/feed/history"),children:"History"},"2"),e.jsx(O.Item,{icon:e.jsx(X,{}),onClick:()=>o("/manage-channel"),children:"You"},"3")]})})},Oe=()=>{const[d,o]=n.useState([]),p=B();n.useEffect(()=>{fetch(w+"/api/home/videos").then(s=>s.json()).then(s=>{o(s)}).catch(s=>console.error("Error fetching videos:",s))},[]);const m=s=>{p(`/watch/${s}`)},c=s=>s.length<=50?s:s.slice(0,47)+"...";return e.jsx("div",{className:"feed",children:d.map(s=>e.jsxs("div",{className:"card",onClick:()=>m(s.videoId),children:[e.jsx("img",{src:s.videoThumbnail,alt:s.videoTitle,className:"thumbnail"}),e.jsxs("div",{className:"video-info",children:[e.jsx("h2",{className:"video-title",children:c(s.videoTitle)}),e.jsx("p",{className:"video-channel",children:s.videoChannelName}),e.jsxs("p",{className:"video-views",children:[s.videoViews," views"]}),e.jsx("p",{className:"video-date",children:new Date(s.videoDate).toLocaleDateString()})]})]},s.videoId))})},_e=({sidebar:d})=>e.jsxs(e.Fragment,{children:[e.jsx(q,{sidebar:d}),e.jsx("div",{className:`container ${d?"":"large-container"}`,children:e.jsx(Oe,{})})]}),{Title:Ae,Paragraph:ns}=W,Me=()=>{const{videoId:d}=ge(),[o,p]=n.useState({title:"",description:"",date:"",owner:""}),[m,c]=n.useState({views:0,likes:0,dislikes:0}),[s,u]=n.useState(""),g=n.useRef(null),k=K(),v=n.useRef(null);n.useEffect(()=>{f(),I();const l=document.querySelector("video");let h=0;const y=()=>{v.current=setInterval(()=>{++h,M()},1e3)},P=()=>{clearInterval(v.current)},T=()=>{clearInterval(v.current)},M=()=>{h>=l.duration/2&&(h=0,x())};return l.addEventListener("play",y),l.addEventListener("pause",P),l.addEventListener("ended",T),()=>{l.removeEventListener("play",y),l.removeEventListener("pause",P),l.removeEventListener("ended",T),clearInterval(v.current)}},[d]),n.useEffect(()=>{const l=document.querySelector("video");return j(l.currentTime),()=>{j(l.currentTime)}},[d,k]);const j=l=>{const h=r();h&&E.post(w+"/api/user/history",null,{params:{user_id:h,video_id:d,track_time:l}}).then(y=>{y.status===200&&y.data.trackTime>0&&(g.current.currentTime=y.data.trackTime,g.current.play())}).catch(y=>{console.error("Error updating user history:",y)})},t=l=>{const y=`; ${document.cookie}`.split(`; ${l}=`);return y.length===2?y.pop().split(";").shift():null},r=()=>{const l=t("user");if(l)try{return JSON.parse(l).userId}catch(h){return console.error("Failed to parse user cookie",h),null}return null},f=()=>{E.get(w+"/api/video/information",{params:{id:d}}).then(l=>{if(l.status===200){let h=l.data.videoDate,y=new Date(h).toLocaleString();E.get(w+"/api/accounts/details",{params:{user_id:l.data.videoOwner}}).then(P=>{p({title:l.data.videoTitle,description:l.data.videoDescription,date:y,owner:P.data.user_fullname})}).catch(P=>{u("Error fetching video owner information."),console.error("Error fetching video owner information:",P)})}else u("Video is not available.")}).catch(l=>{l.response&&l.response.status===404?u("Video not found."):l.response&&l.response.status===500&&u("Server error. Please try again later."),console.error("Error fetching video information:",l)})},I=()=>{E.get(w+"/api/video/interaction",{params:{id:d}}).then(l=>{c({views:l.data.view,likes:l.data.like,dislikes:l.data.dislike})}).catch(l=>{console.error("Error fetching video interactions:",l)})},x=()=>{E.put(w+`/api/video/view?id=${d}`).then(()=>{I()}).catch(l=>{console.error("Error viewing video:",l)})},D=()=>{const l=r();E.put(w+"/api/video/like",null,{params:{user_id:l,video_id:d}}).then(()=>{I()}).catch(h=>{console.error("Error liking video:",h)})},N=()=>{const l=r();E.put(w+"/api/video/dislike",null,{params:{user_id:l,video_id:d}}).then(()=>{I()}).catch(h=>{console.error("Error disliking video:",h)})};return e.jsxs("div",{className:"video-container",children:[s&&e.jsx("p",{className:"error",children:s}),!s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"video-layout",children:[e.jsx("div",{className:"video-column",children:e.jsx("div",{className:"video-wrapper",children:e.jsx("video",{ref:g,controls:!0,className:"video-player",autoPlay:!0,children:e.jsx("source",{src:w+`/api/video?id=${d}`,type:"video/mp4"})})})}),e.jsxs("div",{className:"info-column",children:[e.jsx(Ae,{level:2,className:"video-title",children:e.jsx("div",{children:e.jsx("strong",{children:o.title})})}),e.jsx("div",{className:"video-description",children:e.jsx("div",{children:o.description})}),e.jsxs("div",{className:"interaction-buttons",children:[e.jsx(A,{className:"like-button",type:"danger",size:"large",onClick:D,icon:e.jsx(ve,{}),children:e.jsxs("strong",{children:["Like ",m.likes]})}),e.jsx(A,{className:"dislike-button",type:"danger",size:"large",onClick:N,icon:e.jsx(je,{}),children:e.jsxs("strong",{children:["Dislike ",m.dislikes]})})]}),e.jsx("p",{className:"video-date-1",children:e.jsxs("div",{className:"date-icon",children:[e.jsx(ye,{})," ",e.jsx("em",{children:o.date})]})}),e.jsx("p",{className:"video-owner",children:e.jsxs("div",{className:"channel-icon",children:[e.jsx(X,{})," ",o.owner]})})]})]}),e.jsx("div",{className:"video-views-1",children:e.jsxs("strong",{children:[e.jsx("span",{children:e.jsx(we,{})})," Views: ",m.views]})})]})]})},Ve=()=>{const o=K().pathname==="/login",p=B(),[m,c]=n.useState(""),[s,u]=n.useState(""),g=(t,r,f)=>{const I=new Date;I.setTime(I.getTime()+f*24*60*60*1e3);const x="expires="+I.toUTCString();document.cookie=`${t}=${r};${x};path=/`},k=t=>{const f=`; ${document.cookie}`.split(`; ${t}=`);return f.length===2?f.pop().split(";").shift():null},v=()=>{const t=k("user");if(t)try{return JSON.parse(t).userId}catch(r){return console.error("Failed to parse user cookie",r),null}return null},j=async t=>{t.preventDefault();try{const r=new URLSearchParams;r.append("username",m),r.append("password",s);const f=await fetch(w+"/api/login",{method:"POST",body:r,credentials:"include"});if(f.ok){const I=await f.json();V.success("Login successful"),console.log(v()),sessionStorage.setItem("username",m);const x=JSON.stringify({userId:I.userId,username:I.username,email:I.email,password:I.password,role:I.role});g("user",x,7),setTimeout(()=>{p("/")},1e3)}else throw new Error("Invalid credentials")}catch(r){V.error("Login failed: "+r.message)}};return e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),o&&e.jsx("div",{className:`container ${o?"login-background":""}`,children:e.jsx("div",{className:"wrapper",children:e.jsxs("form",{onSubmit:j,children:[e.jsx("h1",{children:"Login"}),e.jsxs("div",{className:"input-box",children:[e.jsx("input",{type:"text",placeholder:"Username",value:m,onChange:t=>c(t.target.value),required:!0}),e.jsx(Ie,{className:"icon"})]}),e.jsxs("div",{className:"input-box",children:[e.jsx("input",{type:"password",placeholder:"Password",value:s,onChange:t=>u(t.target.value),required:!0}),e.jsx(ke,{className:"icon"})]}),e.jsx("div",{className:"remember-forgot",children:e.jsx(z,{to:"/forgot-password",children:"Forgot password?"})}),e.jsx("button",{type:"submit",children:"Login"}),e.jsx("div",{className:"register-link",children:e.jsxs("p",{children:["Don't have an account? ",e.jsx(z,{to:"/register",children:"Register"})]})})]})})})]})},ze=()=>{const d=K(),o=B(),p=d.pathname==="/register",[m,c]=n.useState(1),[s,u]=n.useState({email:"",username:"",password:"",fullName:"",dob:""}),[g,k]=n.useState(""),[v,j]=n.useState(""),[t,r]=n.useState(""),f=async h=>{const{value:y}=h.target;u({...s,email:y}),y?await x("email",y):j("")},I=async h=>{const{value:y}=h.target;u({...s,username:y}),y?await x("username",y):r("")},x=async(h,y)=>{const P=`${w}/api/accounts/isUser/${h}?${h}=${y}`;try{const T=await fetch(P,{method:"GET"});T.status===409?h==="email"?j("exists"):h==="username"&&r("exists"):T.status===200&&(h==="email"?j("available"):h==="username"&&r("available"))}catch(T){console.error("Error checking availability:",T)}},D=()=>{c(m+1)},N=()=>{c(m-1)},l=async()=>{if(m===1)v==="available"&&t==="available"?D():k("Please fix the errors before proceeding");else try{const h=new FormData;h.append("email",s.email),h.append("username",s.username),h.append("password",s.password),h.append("fullName",s.fullName),h.append("dob",ee(s.dob).format("YYYY-MM-DD"));const y=await fetch(`${w}/api/register`,{method:"POST",body:h,credentials:"include"});if(!y.ok)throw new Error("Registration failed");const P=await y.json();console.log("Registration Successful",P),b.success("Registration successful"),o("/login")}catch(h){console.error("Registration Error:",h.message),k("Registration failed. Please try again.")}};return e.jsx(e.Fragment,{children:p&&e.jsx("div",{className:`container youtube-theme ${p?"login-background":""}`,children:e.jsx("div",{className:"wrapper",children:e.jsxs(C,{onFinish:l,children:[m===1&&e.jsxs("div",{id:"step1",children:[e.jsx("h2",{children:"Account Information"}),e.jsx(C.Item,{validateStatus:v==="exists"?"error":v==="available"?"success":"",help:v==="exists"?"Email already taken":"",children:e.jsx(F,{placeholder:"Email",type:"email",id:"email",name:"email",value:s.email,onChange:f,required:!0,className:`${!s.email||v==="exists"?"input-black":"input-white"} ${v==="exists"?"ant-input-error":v==="available"?"ant-input-success":""}`,suffix:v==="exists"?e.jsx("span",{className:"input-suffix",children:"Email already taken"}):null})}),e.jsx(C.Item,{validateStatus:t==="exists"?"error":t==="available"?"success":"",help:t==="exists"?"Username already taken":"",children:e.jsx(F,{placeholder:"Username",type:"text",id:"username",name:"username",value:s.username,onChange:I,required:!0,className:`${!s.username||t==="exists"?"input-black":"input-white"} ${t==="exists"?"ant-input-error":t==="available"?"ant-input-success":""}`,suffix:t==="exists"?e.jsx("span",{className:"input-suffix",children:"Username already taken"}):null})}),e.jsx(C.Item,{children:e.jsx(F.Password,{placeholder:"Password",id:"password",name:"password",value:s.password,onChange:h=>u({...s,password:h.target.value}),required:!0})}),e.jsxs(C.Item,{children:[e.jsx(A,{type:"default",htmlType:"submit",children:e.jsx("h3",{children:"Next"})}),g&&e.jsx("p",{className:"error",children:g})]})]}),m===2&&e.jsxs("div",{id:"step2",children:[e.jsx("h2",{children:"Personal Information"}),e.jsx(C.Item,{children:e.jsx(F,{placeholder:"Full name",type:"text",id:"fullname",name:"fullName",value:s.fullName,onChange:h=>u({...s,fullName:h.target.value}),required:!0})}),e.jsx(C.Item,{children:e.jsx(Ne,{placeholder:"Date of Birth",id:"dob",name:"dob",value:s.dob?ee(s.dob,"YYYY-MM-DD"):null,onChange:(h,y)=>u({...s,dob:y}),required:!0})}),e.jsx(C.Item,{className:"custom-button-item",children:e.jsx(A,{type:"default",onClick:N,className:"custom-back-button",children:e.jsx("h3",{children:"Back"})})}),e.jsx(C.Item,{className:"custom-button-item",children:e.jsx(A,{type:"default",htmlType:"submit",className:"custom-complete-button",children:e.jsx("h3",{children:"Complete"})})})]})]})})})})},{Title:qe}=W,{TextArea:Ye}=F,J=50*1024*1024,Je=({sidebar:d})=>{const[o,p]=n.useState(""),[m,c]=n.useState(""),[s,u]=n.useState(null),[g,k]=n.useState(null),[v,j]=n.useState(null),[t,r]=n.useState(0),[f,I]=n.useState(""),[x,D]=n.useState("");n.useEffect(()=>{const i=document.cookie.split(";").reduce((a,S)=>{const[R,$]=S.split("=").map(U=>U.trim());return a[R]=decodeURIComponent($),a},{});if(i.user){const a=JSON.parse(i.user);j(a.userId)}},[]);const N=i=>{p(i.currentTarget.value)},l=i=>{c(i.currentTarget.value)},h=i=>{const a=i[0];a&&a.type.startsWith("video/")?(u(a),I(URL.createObjectURL(a))):b.error("Please upload a valid video file")},y=i=>{const a=i[0];a&&a.type.startsWith("image/")?(k(a),D(URL.createObjectURL(a))):b.error("Please upload a valid image file")},P=async(i,a,S,R,$,U)=>{const _=new FormData;_.append("chunk",i),_.append("videoId",a),_.append("ext",S),_.append("index",R),_.append("totalChunks",$),_.append("type",U);try{await E.put(w+"/api/video/upload",_).then(Y=>{Y.status===201&&(U==="video"?b.success("Video uploaded successfully"):b.success("Thumbnail uploaded successfully"))})}catch(Y){console.error("Error uploading chunk:",Y)}},T=async()=>{if(!s)return;let i="";const a=new FormData;a.append("title",o),a.append("description",m),a.append("userId",v),await fetch(w+"/api/video/upload",{method:"POST",body:a}).then($=>$.json()).then($=>{i=$.videoId});const S=Math.ceil(s.size/J),R=Math.ceil(g.size/J);for(let $=0;$<S;$++){const U=$*J,_=Math.min(U+J,s.size),Y=s.slice(U,_),H=s.name,Q=H.substring(H.lastIndexOf(".")+1);await P(Y,i,Q,$,S,"video"),r(Math.round(($+1)/S*100))}for(let $=0;$<R;$++){const U=$*J,_=Math.min(U+J,g.size),Y=g.slice(U,_),H=g.name,Q=H.substring(H.lastIndexOf(".")+1);await P(Y,i,Q,$,R,"thumbnail")}},M=()=>{if(!o||!m||!s||!g||!v)return b.error("Please fill all the fields and upload the required files");T()};return e.jsxs(e.Fragment,{children:[e.jsx(q,{sidebar:d}),e.jsxs("div",{className:`upload-video-container ${d?"":"large-container"}`,children:[e.jsx("div",{className:"upload-video-header",children:e.jsx(qe,{level:2,children:"Upload Video "})}),e.jsxs(C,{children:[e.jsxs("div",{className:"dropzone-container",children:[e.jsxs("div",{className:"dropzone-section",children:[e.jsx("label",{children:"Video File (Allow video type)"}),e.jsx(se,{onDrop:h,multiple:!1,children:({getRootProps:i,getInputProps:a})=>e.jsxs("div",{className:"dropzone",...i(),children:[e.jsx("input",{...a(),accept:"video/*"}),s?e.jsx("video",{width:"100%",height:"240px",controls:!0,children:e.jsx("source",{src:f,type:"video/mp4"})}):e.jsx(te,{style:{fontSize:"3rem"}})]})})]}),e.jsxs("div",{className:"dropzone-section",children:[e.jsx("label",{children:"Thumbnail File"}),e.jsx(se,{onDrop:y,multiple:!1,maxSize:8e8,children:({getRootProps:i,getInputProps:a})=>e.jsxs("div",{className:"dropzone",...i(),children:[e.jsx("input",{...a()}),g?e.jsx("img",{src:x,alt:"Thumbnail",width:"100%",height:"240px"}):e.jsx(te,{style:{fontSize:"3rem"}})]})})]})]}),t>0&&e.jsx(Se,{percent:t}),e.jsx("label",{children:"Title"}),e.jsx(F,{onChange:N,value:o}),e.jsx("label",{children:"Description"}),e.jsx(Ye,{onChange:l,value:m}),e.jsx(A,{type:"primary",size:"large",onClick:M,className:"submit-button",children:"Submit"})]})]})]})},Be=({sidebar:d})=>{const[o,p]=n.useState([]),[m,c]=n.useState([]),[s,u]=n.useState(!0),[g,k]=n.useState(null),[v,j]=n.useState(""),[t,r]=n.useState(1),[f,I]=n.useState(!1),x=i=>{const S=`; ${document.cookie}`.split(`; ${i}=`);return S.length===2?S.pop().split(";").shift():null},N=(()=>{const i=x("user");if(i)try{return JSON.parse(i).userId}catch(a){return console.error("Failed to parse user cookie",a),null}return null})();n.useEffect(()=>{(async()=>{try{const a=await E.get(w+"/api/accounts/users"),S=await E.get(w+"/api/accounts/admins");p(a.data),c(S.data)}catch(a){console.error("Error fetching accounts:",a),b.error("An error occurred while fetching accounts.")}finally{u(!1)}})()},[]);const l=async(i,a)=>{try{await E.put(w+"/api/admin/accounts",null,{params:{current_user_id:N,modify_user_id:i,modify_role:a}}),b.success("Role updated successfully.");const S=o.map(R=>R.userId===i?{...R,role:a}:R);p(S)}catch(S){if(S.response)switch(S.response.status){case 403:b.error("You do not have permission to update this role.");break;case 404:b.error("Cannot find role for modified account.");break;case 304:b.error("Error when updating role.");break;default:b.error("An error occurred while updating the role.")}else b.error("An error occurred while updating the role.")}},h=async i=>{try{await E.delete(w+"/api/admin/accounts",{params:{current_user_id:N,delete_user_id:i}}),b.success("Account deleted successfully.");const a=o.filter(S=>S.userId!==i);p(a)}catch(a){if(a.response)switch(a.response.status){case 403:b.error("You do not have permission to delete this account.");break;case 404:b.error("Cannot find delete role account.");break;case 304:b.error("Error when deleting account.");break;default:b.error("An error occurred while deleting the account.")}else b.error("An error occurred while deleting the account.")}},y=async i=>{try{const a=await E.get(w+"/api/accounts/details",{params:{user_id:i}});k(a.data),I(!0)}catch(a){a.response?a.response.status===404?j("User ID not found or something went wrong."):a.response.status===500?j("Internal Server Error. Please try again later."):j("An error occurred while fetching account details."):j("An error occurred while fetching account details."),k(null)}},P=()=>{I(!1),k(null),j("")},T=i=>i.filter(a=>t===1?a.role===1||a.role===2||a.role===3:t===2?a.role===2||a.role===3:!1),M=[{title:"User ID",dataIndex:"userId",key:"userId"},{title:"Username",dataIndex:"username",key:"username"},{title:"Actions",key:"actions",render:(i,a)=>e.jsxs(e.Fragment,{children:[e.jsx(A,{type:"primary",onClick:()=>l(a.userId,"2"),style:{marginRight:8},children:"Update"}),e.jsx(A,{type:"danger",onClick:()=>h(a.userId),children:"Delete"})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(q,{sidebar:d}),e.jsx("div",{className:`manage-account ${d?"":"large-container"}`,children:s?e.jsx("p",{children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Users"}),e.jsx(Z,{columns:M,dataSource:T(o),rowKey:"userId",pagination:{pageSize:5},onRow:i=>({onClick:()=>y(i.userId)})}),e.jsx("h2",{children:"Staffs"}),e.jsx(Z,{columns:M,dataSource:T(m),rowKey:"userId",pagination:{pageSize:5},onRow:i=>({onClick:()=>y(i.userId)})}),e.jsx(be,{visible:f,title:"Account Details",onCancel:P,footer:null,children:v?e.jsx("p",{className:"error",children:v}):g&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Username: ",g.user_fullname]}),e.jsxs("p",{children:["Birthday: ",g.user_dob]})]})})]})})]})},Ke=({sidebar:d})=>{const[o,p]=n.useState(null),[m,c]=n.useState([]),[s,u]=n.useState(null),[g,k]=n.useState(!0),v=t=>{const f=`; ${document.cookie}`.split(`; ${t}=`);return f.length===2?f.pop().split(";").shift():null},j=()=>{const t=v("user");if(t)try{return JSON.parse(t).userId}catch(r){return console.error("Failed to parse user cookie",r),null}return null};return n.useEffect(()=>{const t=j();t?p(t):u("User not logged in or invalid user data.")},[]),n.useEffect(()=>{k(!0),E.get(w+"/api/user/video/management",{params:{user_id:o}}).then(t=>{c(t.data),u(""),k(!1)}).catch(t=>{k(!1),t.response?t.response.status===400?u("Missing parameter: user_id."):t.response.status===404?u("User ID not found."):u("Error fetching videos. Please try again later."):u("Error fetching videos. Please try again later."),console.error("Error fetching videos:",t)})},[o]),g?e.jsx(G,{size:"large"}):s?e.jsxs("div",{children:["Error: ",s]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{sidebar:d}),e.jsx("div",{className:`manage-channel-container ${d?"":"large-container"}`,children:e.jsxs("div",{className:"manage-channel",children:[e.jsx("h1",{children:"Manage Channel"}),s?e.jsx("p",{className:"error-message",children:s}):m.length>0?e.jsx("div",{className:"video-list",children:m.map(t=>e.jsxs("div",{className:"video-item",children:[e.jsx(z,{to:`/watch/${t.videoId}`,children:e.jsx("img",{src:t.videoThumbnail,alt:t.videoTitle,className:"video-thumbnail"})}),e.jsxs("div",{className:"video-details",children:[e.jsx("h2",{className:"video-title",children:t.videoTitle}),e.jsx("p",{className:"video-description",children:t.videoDescription}),e.jsx("p",{className:"video-date",children:new Date(t.videoDate).toLocaleDateString()})]})]},t.videoId))}):e.jsx("p",{children:"No videos found."})]})})]})},{Title:He,Paragraph:We}=W,Ge=({sidebar:d})=>{const[o,p]=n.useState([]),[m,c]=n.useState(""),[s,u]=n.useState(!0),g=K(),v=new URLSearchParams(g.search).get("key");n.useEffect(()=>{t()},[v]);const j=r=>r.length<=20?r:r.slice(0,17)+"...",t=async()=>{u(!0);try{if(v){const r=encodeURIComponent(v),I=(await E.get(w+`/api/home/search/results?key=${r}`)).data;I.length>0?(p(I),c("")):(c("No search results found."),p([]))}else c("No search query specified."),p([])}catch{c("An error occurred while fetching the search results."),p([])}finally{u(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(q,{sidebar:d}),e.jsxs("div",{className:`search-page ${d?"":"large-container"}`,children:[e.jsxs(He,{level:2,children:['Search Results for "',v||"",'"']}),s?e.jsx("div",{className:"loader"}):m?e.jsx(We,{children:m}):e.jsx("div",{className:"video-list",children:o.length>0?o.map(r=>e.jsxs(Ce,{className:"video-card",hoverable:!0,children:[e.jsx(z,{to:`/watch/${r.videoId}`,className:"thumbnail-container",children:e.jsx("img",{alt:r.videoTitle,src:r.videoThumbnail,className:"card-img-top"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(z,{to:`/watch/${r.videoId}`,children:e.jsx("h5",{className:"card-title",children:j(r.videoTitle)})}),e.jsx("h3",{className:"card-text",children:r.videoChannelName}),e.jsx("div",{className:"card-details",children:e.jsxs("span",{className:"views",children:[r.videoViews," views"]})})]})]},r.videoId)):e.jsx(De,{description:"No search results found."})})]})]})},Qe=({sidebar:d})=>{const[o,p]=n.useState([]),[m,c]=n.useState(!0),[s,u]=n.useState(null);n.useEffect(()=>{v()},[]);const g=r=>{const I=`; ${document.cookie}`.split(`; ${r}=`);return I.length===2?I.pop().split(";").shift():null},k=()=>{const r=g("user");if(r)try{return JSON.parse(r).userId}catch(f){return console.error("Failed to parse user cookie",f),null}return null},v=async()=>{const r=k();if(!r){u("User ID not found in cookie"),c(!1);return}try{const f=await E.get(w+`/api/user/history?user_id=${r}`);p(f.data||[]),c(!1)}catch(f){f.response?f.response.status===400?u("Missing parameter"):f.response.status===404?u("User ID not found"):u("Failed to fetch data"):u("Network error"),c(!1)}},j=async r=>{try{const f=k();if(!f){u("User ID not found in cookie");return}await E.delete(w+`/api/user/history/${r}?user_id=${f}`),v()}catch(f){console.error("Failed to delete video:",f)}},t=[{title:"Thumbnail",dataIndex:"videoThumbnail",key:"thumbnail",render:(r,f)=>e.jsx(z,{to:`/watch/${f.videoId}`,className:"thumbnail-container",children:e.jsx("img",{src:r,alt:f.videoTitle,className:"card-img-top"})})},{title:"Title",dataIndex:"videoTitle",key:"title",render:r=>e.jsx("span",{children:r})},{title:"Description",dataIndex:"videoDescription",key:"description",render:r=>e.jsx("span",{children:r})},{title:"Watched",dataIndex:"trackTime",key:"trackTime",render:r=>e.jsxs("span",{children:[r," seconds"]})},{title:"Action",key:"action",render:(r,f)=>e.jsx(Ee,{size:"middle",children:e.jsx("button",{onClick:()=>j(f.videoId),className:"delete-button",children:"Remove"})})}];return m?e.jsx(G,{size:"large"}):s?e.jsxs("div",{children:["Error: ",s]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{sidebar:d}),e.jsxs("div",{className:`history-container ${d?"":"large-container"}`,children:[e.jsx("h1",{className:"history-title",children:"Watch History"}),e.jsx(Z,{dataSource:o,columns:t,rowKey:"videoId",pagination:{pageSize:5}})]})]})};oe.setAppElement("#root");const Ze=({sidebar:d})=>{const[o,p]=n.useState([]),[m,c]=n.useState(!0),[s,u]=n.useState(""),[g,k]=n.useState(null),v=x=>{const N=`; ${document.cookie}`.split(`; ${x}=`);return N.length===2?N.pop().split(";").shift():null},j=()=>{const x=v("user");if(x)try{return JSON.parse(x).userId}catch(D){return console.error("Failed to parse user cookie",D),null}return null};n.useEffect(()=>{const x=j();E.get(w+`/api/admin/review?user_id=${x}`).then(D=>{p(D.data||[]),c(!1)}).catch(D=>{console.error("Error fetching videos:",D),u("Error fetching videos"),c(!1)})},[]);const t=x=>{const D=j();E.put(w+`/api/admin/review?user_id=${D}&video_id=${x}`).then(N=>{N.status===200?(p(l=>l.filter(h=>h.videoId!==x)),V.success("Video accepted successfully")):N.status===401?(u("Invalid role to modify"),V.error("Invalid role to modify")):N.status===404&&(u("Cannot find this video"),V.error("Cannot find this video"))}).catch(N=>{console.error("Error accepting video:",N),u("Error accepting video"),V.error("Error accepting video")})},r=x=>{const D=j();E.delete(w+`/api/admin/review?user_id=${D}&video_id=${x}`).then(N=>{N.status===200?(p(l=>l.filter(h=>h.videoId!==x)),V.success("Video deleted successfully")):N.status===401?(u("Invalid role to delete"),V.error("Invalid role to delete")):N.status===404&&(u("Cannot find this video"),V.error("Cannot find this video"))}).catch(N=>{console.error("Error deleting video:",N),u("Error deleting video"),V.error("Error deleting video")})},f=x=>{k(x)},I=()=>{k(null)};return m?e.jsx(G,{size:"large"}):s?e.jsxs("div",{children:["Error: ",s]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{sidebar:d}),e.jsxs("div",{className:`admin-page ${d?"":"large-container"}`,children:[e.jsx(ne,{}),e.jsx("h1",{children:"Admin Page"}),s&&e.jsx("p",{style:{color:"red"},children:s}),e.jsx("ul",{className:"video-list",children:o.map(x=>e.jsxs("li",{className:"video-item",children:[e.jsx("div",{onClick:()=>f(x),children:e.jsx("img",{src:w+`/api/video/thumbnail?id=${x.videoId}`,alt:x.videoTitle})}),e.jsxs("div",{className:"video-details",children:[e.jsx("h2",{className:"video-title",children:x.videoTitle}),e.jsx("p",{className:"video-description",children:x.videoDescription}),e.jsx("p",{className:"video-meta",children:new Date(x.videoDate).toLocaleString()}),e.jsxs("p",{className:"video-owner",children:["Owner: ",x.videoChannelName]}),e.jsxs("p",{className:"video-meta",children:["Status: ",x.videoStatus?"Accepted":"Pending"]}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{className:"button-accept",onClick:()=>t(x.videoId),children:"Accept"}),e.jsx("button",{className:"button-delete",onClick:()=>r(x.videoId),children:"Delete"})]})]})]},x.videoId))}),g&&e.jsxs(oe,{isOpen:!!g,onRequestClose:I,className:"react-modal-content",overlayClassName:"react-modal-overlay",children:[e.jsx("h2",{children:g.videoTitle}),e.jsx("p",{children:g.videoDescription}),e.jsx("p",{children:new Date(g.videoDate).toLocaleString()}),e.jsxs("p",{children:["Owner: ",g.videoOwner]}),e.jsxs("p",{children:["Status: ",g.videoStatus?"Accepted":"Pending"]}),e.jsxs("video",{width:"100%",controls:!0,children:[e.jsx("source",{src:w+`/api/video?id=${g.videoId}`,type:"video/webm"}),"Your browser does not support the video tag."]}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{className:"button-accept",onClick:()=>{t(g.videoId),I()},children:"Accept"}),e.jsx("button",{className:"button-delete",onClick:()=>{r(g.videoId),I()},children:"Delete"})]})]})]})]})},{Title:Xe}=W,es=d=>{const p=`; ${document.cookie}`.split(`; ${d}=`);return p.length===2?p.pop().split(";").shift():null},re=()=>{const d=es("user");if(d)try{return JSON.parse(d).userId}catch(o){return console.error("Failed to parse user cookie",o),null}return null},ss=({sidebar:d})=>{const[o,p]=n.useState(null),[m,c]=n.useState(null),[s,u]=n.useState(!1);n.useEffect(()=>{(async()=>{const r=re();if(!r){c("User ID not found in cookies");return}try{let x=(await(await fetch(w+"/api/accounts/users")).json()).find(a=>a.userId===r);if(x||(x=(await(await fetch(w+"/api/accounts/admins")).json()).find(R=>R.userId===r)),!x){c("User not found");return}const D=await fetch(w+`/api/accounts/details?user_id=${r}`);if(D.status===404){c("User ID is wrong or something went wrong");return}const N=await D.json(),l=new Date(N.user_dob),h=l.getFullYear(),y=String(l.getMonth()+1).padStart(2,"0"),P=String(l.getDate()).padStart(2,"0"),T=`${h}-${y}-${P}`,M=N.user_id,i=N.user_fullname;p({user_dob:T,user_id:M,user_fullname:i,email:x.email,username:x.username})}catch{c("Failed to fetch account details")}})()},[]);const g=()=>{u(!s)},k=t=>{p({...o,user_fullname:t.target.value})},v=t=>{p({...o,user_dob:t.target.value})},j=async()=>{try{const t=re();if(!t){c("User ID not found in cookies");return}const{user_fullname:r,user_dob:f}=o;console.log(f),await E.put(w+`/api/accounts/details?user_id=${t}&full_name=${r}&dob=${f}`),u(!1),c(null),b.success("Account details updated successfully")}catch{c("Failed to save account details")}};return m?e.jsx($e,{message:"Error",description:m,type:"error",showIcon:!0}):o?e.jsxs(e.Fragment,{children:[e.jsx(q,{sidebar:d}),e.jsxs("div",{className:`account-info-container ${d?"":"large-container"}`,children:[e.jsx(Xe,{level:2,className:"account-info-title",children:"Account Details"}),e.jsxs(C,{layout:"vertical",className:"account-info-form",children:[e.jsx(C.Item,{label:"User ID",children:e.jsx(F,{value:o.user_id,readOnly:!0})}),e.jsx(C.Item,{label:"Email",children:e.jsx(F,{value:o.email,readOnly:!0})}),e.jsx(C.Item,{label:"Username",children:e.jsx(F,{value:o.username,readOnly:!0})}),e.jsx(C.Item,{label:"Full Name",children:s?e.jsx(F,{value:o.user_fullname,onChange:k}):e.jsx(F,{value:o.user_fullname,readOnly:!0})}),e.jsx(C.Item,{label:"Date of Birth",children:s?e.jsx(F,{type:"date",value:o.user_dob,onChange:v}):e.jsx(F,{type:"date",value:o.user_dob,readOnly:!0})}),e.jsx(C.Item,{children:e.jsx(A,{type:"primary",onClick:s?j:g,children:s?"Save":"Edit"})})]})]})]}):e.jsx(G,{size:"large"})},{Title:ae}=W,ts=()=>{const[d,o]=n.useState(""),[p,m]=n.useState(1),[c,s]=n.useState(""),[u,g]=n.useState(""),k=B(),v=async()=>{try{(await E.post(w+`/api/accounts/forgot-password?email=${d}`)).status===200&&(m(2),b.success("OTP sent to your email."))}catch(t){t.response?t.response.status===404?b.error("Email not found"):t.response.status===500?b.error("Server error. Please try again later."):b.error("Failed to send OTP. Please check your email and try again."):b.error("Failed to send OTP. Please check your email and try again.")}},j=async()=>{try{(await E.put(w+`/api/accounts/forgot-password?email=${d}&otp=${c}&new_password=${u}`)).status===200&&(b.success("Password reset successful. Redirecting to login..."),k("/login"))}catch(t){t.response&&t.response.status===400?b.error("Invalid OTP. Please try again."):b.error("Invalid OTP or email not found. Please try again.")}};return e.jsx("div",{className:"forgot-password-container",children:p===1?e.jsxs("div",{className:"forgot-password-form",children:[e.jsx(ae,{level:2,children:"Forgot Password"}),e.jsxs(C,{onFinish:v,children:[e.jsx(C.Item,{label:"Email",name:"email",rules:[{required:!0,message:"Please input your email!"}],children:e.jsx(F,{type:"email",value:d,onChange:t=>o(t.target.value)})}),e.jsx(C.Item,{children:e.jsx(A,{type:"primary",htmlType:"submit",block:!0,children:"Send OTP"})})]})]}):e.jsxs("div",{className:"forgot-password-form",children:[e.jsx(ae,{level:2,children:"Enter OTP"}),e.jsxs(C,{onFinish:j,children:[e.jsx(C.Item,{label:"OTP",name:"otp",rules:[{required:!0,message:"Please input the OTP!"}],children:e.jsx(F,{value:c,onChange:t=>s(t.target.value)})}),e.jsx(C.Item,{label:"New Password",name:"newPassword",rules:[{required:!0,message:"Please input your new password!"}],children:e.jsx(F.Password,{value:u,onChange:t=>g(t.target.value)})}),e.jsx(C.Item,{children:e.jsx(A,{type:"primary",htmlType:"submit",block:!0,children:"Submit OTP"})})]})]})})},rs=()=>{const d=K(),[o,p]=n.useState(!0),m=d.pathname==="/login",c=d.pathname==="/register",s=d.pathname==="/forgot-password";return e.jsxs("div",{children:[!m&&!c&&!s&&e.jsx(Ue,{setSidebar:p}),e.jsxs(Pe,{children:[e.jsx(L,{path:"/login",element:e.jsx(Ve,{})}),e.jsx(L,{path:"/register",element:e.jsx(ze,{})}),e.jsx(L,{path:"/forgot-password",element:e.jsx(ts,{})}),e.jsx(L,{path:"/",element:e.jsx(_e,{sidebar:o})}),e.jsx(L,{path:"/upload",element:e.jsx(Je,{sidebar:o})}),e.jsx(L,{path:"/account-info",element:e.jsx(ss,{sidebar:o})}),e.jsx(L,{path:"/admin-page",element:e.jsx(Ze,{sidebar:o})}),e.jsx(L,{path:"/manage-account",element:e.jsx(Be,{sidebar:o})}),e.jsx(L,{path:"/manage-channel",element:e.jsx(Ke,{sidebar:o})}),e.jsx(L,{path:"/watch/:videoId",element:e.jsx(Me,{sidebar:o})}),e.jsx(L,{path:"/search",element:e.jsx(Ge,{sidebar:o})}),e.jsx(L,{path:"/feed/history",element:e.jsx(Qe,{sidebar:o})})]})]})};Te.createRoot(document.getElementById("root")).render(e.jsx(Re,{children:e.jsx(rs,{})}));
